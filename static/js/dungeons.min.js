(function(){function e(){j=document.getElementById("dungeonList"),P=document.getElementById("empty"),U=Array.from(j.getElementsByClassName("dungeon-details")),H=Array.from(j.getElementsByClassName("party-details")),G=null}function t(e,t=!0){t&&q.forEach((e=>saveData(e,e.value))),t&&saveData(C,C.selectedIndex);const n=p.value.customSplitFilter(","),a=E.value.customSplitFilter(","),l=f.value.customSplitFilter(","),s=C.value;let o=!1;U.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),r=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),d=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),c=e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank,i=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(r,e)))&&l.customSomeFilter((e=>checkLevel(d,e)))&&("default"===s||s==c);e.style.display=i?"":"none",o||=i})),d(!o)}function n(e,t=!0){function n(e,t,n){const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),o=parseInt(t.getElementsByClassName("dungeon-ilvl")[0].textContent),r=e.getElementsByClassName("dungeon-name")[0].textContent,d=t.getElementsByClassName("dungeon-name")[0].textContent,c=e.getElementsByClassName("party-player-detailed-content").length,i=t.getElementsByClassName("party-player-detailed-content").length,u=parseInt(e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank),m=parseInt(t.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank);switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"minItemLevelDesc":return o-s;case"minItemLevelAsc":return s-o;case"nameDesc":return d.localeCompare(r);case"nameAsc":return r.localeCompare(d);case"playersDesc":return i-c;case"playersAsc":return c-i;case"rankDesc":return m-u;case"rankAsc":return u-m}}t&&saveData(v,v.selectedIndex);const a=v.value,l=v.options[M].value;a!==l&&U.sort(((e,t)=>n(e,t,l))),U.sort(((e,t)=>n(e,t,a))),U.forEach((e=>j.appendChild(e)))}function a(e,a=!0){if(a&&saveData(D,D.checked,!1),null!=G){let e=U;U=G,G=e,G.forEach((e=>j.removeChild(e))),U.forEach((e=>j.appendChild(e)))}else{if(!D.checked)return!1;{let e=U.find((e=>e.querySelector(".dungeon-lvl").innerText==X.lowestDungeonLevel));if(null==e)return!1;let t=Array.from(e.getElementsByClassName("party-details")),n=t.filter((e=>e.querySelector(".party-player-detailed-content.level65")));if(0===n.length)return!1;let a=[];n.forEach((e=>{let t=Array.from(e.getElementsByClassName("party-summary"));t.forEach((e=>e.innerText.split("|").forEach((e=>{let t=e.trim().split(" ")[0];a.push(t)}))))}));let s=U.filter((e=>e.querySelector(".dungeon-lvl").innerText<X.minLevel&&null!=e.querySelector(".party-player-detailed-content.level65")));s.forEach((function(e){j.removeChild(e);let t=e.cloneNode(!0),s=Array.from(t.getElementsByClassName("party-details"));if(n.length===s.length)return;let o=Array.from(t.getElementsByClassName("dungeon-role"));a.forEach((e=>{o.forEach((t=>{if(t.innerText.includes(e)){let n=parseInt(t.innerText)-1;t.innerText=n+e}}))})),s.filter((e=>null!=e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>t.removeChild(e))),t.addEventListener("toggle",l),j.appendChild(t)}));let o=e.cloneNode(!0);o.setAttribute("id","9999"),o.querySelector(".dungeon-lvl").innerText=X.minLevel,o.querySelector(".dungeon-ilvl").innerText=X.minItemLevel,o.querySelector(".dungeon-name").innerText=X.name;let r=Array.from(o.getElementsByClassName("party-details"));if(n.length!==r.length){let e=Array.from(o.getElementsByClassName("dungeon-role"));e.forEach((e=>{let t=parseInt(e.innerText).toString().length;e.innerText=0+e.innerText.slice(t)})),a.forEach((t=>{e.forEach((e=>{if(e.innerText.includes(t)){let n=parseInt(e.innerText)+1;e.innerText=n+t}}))})),r.filter((e=>null==e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>{o.removeChild(e)}))}o.addEventListener("toggle",l),j.appendChild(o),G=U,U=Array.from(j.getElementsByClassName("dungeon-details"))}}return a&&s(null,!1),n(null,!1),t(null,!1),!0}function l(){const e=this.parentElement,t=e.id,n=J.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&J.splice(n,1):J.push(t),K=!1,s()}function s(e,t=!0){if(t&&saveData(x,x.checked,!1),x.checked){const e=K?"all":J.join(",");saveData(R,e),saveData(B,B.dataset.value)}else saveData(R,null),saveData(B,null)}function o(){const e="true"===this.dataset.value;this.dataset.value=!e,K=e,J=[],U.forEach((e=>{e.open=!K,K&&J.push(e.id)})),x.checked&&s(null,!1)}function r(){const e=this.dataset.partyId,t=W.indexOf(e);this.open&&-1===t?W.push(e):this.open||-1===t||W.splice(t,1)}function d(e){0!==j.children.length&&(P.hidden=!e,P.querySelector("#initialEmpty").hidden=e,P.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(k,k.checked,!1),u(k.checked)}function i(e,t=!0){t&&saveData(N,N.checked,!1),u(N.checked,!0)}function u(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=j.getElementsByClassName(n);for(const t of a)t.hidden=e}function m(e,t=!0){t&&saveData(S,S.checked,!1);const n=j.getElementsByClassName("dungeon-rank");for(const e of n)e.hidden=S.checked}function g(){q.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function h(){e(),y(),U.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),H.forEach((e=>e.addEventListener("toggle",r)))}function y(){a(null,!1)||(n(null,!1),t(null,!1)),j.style.fontSize=Y[V],J=K?U.map((e=>e.id)):J.filter((e=>U.some((t=>t.id===e)))),U.forEach((e=>e.open=-1===J.indexOf(e.id))),s(null,!1),c(null,!1),i(null,!1),m(null,!1),H.forEach((e=>e.open=-1!==W.indexOf(e.dataset.partyId))),W=W.filter((e=>H.some((t=>t.dataset.partyId===e))))}const p=document.getElementById("searchDungeonName"),E=document.getElementById("searchDungeonLevel"),f=document.getElementById("searchDungeonItemLevel"),v=document.getElementById("selectDungeonSort"),C=document.getElementById("selectDungeonRank"),B=document.getElementById("toggleDetails"),I=document.getElementById("clearNavigation"),L=document.getElementById("clearEmptyButton"),x=document.getElementById("saveCollapsed"),D=document.getElementById("mergeSupportMatching"),k=document.getElementById("hideLevel"),N=document.getElementById("hideItemLevel"),S=document.getElementById("hideRank"),A=document.body,T=document.getElementById("content"),q=[p,E,f],F=[x,D,k,N,S],w=[v,C],M=2,O=0,R="dungeonDetailsCollapsed",X=supportDungeonProps,Y=["13px","14px","16px"],z=30,b="pinchDungeonList";let j,P,U,G,H;e();let J=[],K=!1,Q=0,V=Y.indexOf(window.getComputedStyle(j).fontSize),W=[];v.addEventListener("change",n),p.addEventListener("input",t),E.addEventListener("input",t),f.addEventListener("input",t),C.addEventListener("change",t),U.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),H.forEach((e=>e.addEventListener("toggle",r))),x.addEventListener("change",s),D.addEventListener("change",a),k.addEventListener("change",c),N.addEventListener("change",i),S.addEventListener("change",m),T.addEventListener("contentUpdated",h),B.addEventListener("click",o),L.addEventListener("click",g),I.addEventListener("click",(function(){v.selectedIndex=M,C.selectedIndex=O,g()})),A.addEventListener("touchstart",(function(e){2===e.touches.length&&(Q=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY))})),A.addEventListener("touchmove",(function(e){if(2===e.touches.length){let t=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY);if(t-Q>z)V=Math.min(V+1,Y.length-1);else{if(!(Q-t>z))return;V=Math.max(V-1,0)}j.style.fontSize=Y[V],Q=t,saveData(b,V,!1)}})),A.addEventListener("touchend",(function(e){e.touches.length<2&&(Q=0)})),q.forEach((e=>e.value=loadData(e)??e.value)),F.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),w.forEach((e=>e.selectedIndex=loadData(e)??e.selectedIndex)),B.dataset.value=loadData(B)??B.dataset.value;const Z=loadData(R);"all"===Z?K=!0:J=Z?.split(",")??[],V=loadData(b,!1)??V,y()})();