(function(){function e(){G=document.getElementById("dungeonList"),H=document.getElementById("empty"),J=Array.from(G.getElementsByClassName("dungeon-details")),P=Array.from(G.getElementsByClassName("party-details")),K=null}function t(e,t=!0){t&&O.forEach((e=>saveData(e,e.value))),t&&saveData(I,I.selectedIndex);const n=p.value.customSplitFilter(","),a=v.value.customSplitFilter(","),l=C.value.customSplitFilter(","),s=I.value;let o=!1;J.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),r=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),d=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),c=e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank,i=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(r,e)))&&l.customSomeFilter((e=>checkLevel(d,e)))&&("default"===s||s==c);e.style.display=i?"":"none",o||=i})),d(!o)}function n(e,t=!0){function n(e,t,n){const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),o=parseInt(t.getElementsByClassName("dungeon-ilvl")[0].textContent),r=e.getElementsByClassName("dungeon-name")[0].textContent,d=t.getElementsByClassName("dungeon-name")[0].textContent,c=e.getElementsByClassName("party-player-detailed-content").length,i=t.getElementsByClassName("party-player-detailed-content").length,u=parseInt(e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank),m=parseInt(t.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank);switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"minItemLevelDesc":return o-s;case"minItemLevelAsc":return s-o;case"nameDesc":return d.localeCompare(r);case"nameAsc":return r.localeCompare(d);case"playersDesc":return i-c;case"playersAsc":return c-i;case"rankDesc":return m-u;case"rankAsc":return u-m}}t&&saveData(B,B.selectedIndex);const a=B.value,l=B.options[M].value;a!==l&&J.sort(((e,t)=>n(e,t,l))),J.sort(((e,t)=>n(e,t,a))),J.forEach((e=>G.appendChild(e)))}function a(e,a=!0){if(a&&saveData(D,D.checked,!1),null!=K){let e=J;J=K,K=e,K.forEach((e=>G.removeChild(e))),J.forEach((e=>G.appendChild(e)))}else{if(!D.checked)return!1;{let e=J.find((e=>e.querySelector(".dungeon-lvl").innerText==w.dataset.lowestDungeonLevel));if(null==e)return!1;let t=Array.from(e.getElementsByClassName("party-details")),n=t.filter((e=>e.querySelector(".party-player-detailed-content.level65")));if(0===n.length)return!1;let a=[];n.forEach((e=>{let t=Array.from(e.getElementsByClassName("party-summary"));t.forEach((e=>e.innerText.split("|").forEach((e=>{let t=e.trim().split(" ")[0];a.push(t)}))))}));let s=J.filter((e=>e.querySelector(".dungeon-lvl").innerText<parseInt(w.dataset.minLevel)&&null!=e.querySelector(".party-player-detailed-content.level65")));s.forEach((function(e){G.removeChild(e);let t=e.cloneNode(!0),s=Array.from(t.getElementsByClassName("party-details"));if(n.length===s.length)return;let o=Array.from(t.getElementsByClassName("dungeon-role"));a.forEach((e=>{o.forEach((t=>{if(t.innerText.includes(e)){let n=parseInt(t.innerText)-1;t.innerText=n+e}}))})),s.filter((e=>null!=e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>t.removeChild(e))),t.addEventListener("toggle",l),G.appendChild(t)}));let o=e.cloneNode(!0);o.setAttribute("id",w.dataset.id),o.querySelector(".dungeon-lvl").innerText=w.dataset.minLevel,o.querySelector(".dungeon-ilvl").innerText=w.dataset.minItemLevel,o.querySelector(".dungeon-name").innerText=w.dataset.name;let r=Array.from(o.getElementsByClassName("party-details"));if(n.length!==r.length){let e=Array.from(o.getElementsByClassName("dungeon-role"));e.forEach((e=>{let t=parseInt(e.innerText).toString().length;e.innerText=0+e.innerText.slice(t)})),a.forEach((t=>{e.forEach((e=>{if(e.innerText.includes(t)){let n=parseInt(e.innerText)+1;e.innerText=n+t}}))})),r.filter((e=>null==e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>{o.removeChild(e)}))}o.addEventListener("toggle",l),G.appendChild(o),K=J,J=Array.from(G.getElementsByClassName("dungeon-details"))}}return a&&s(null,!1),n(null,!1),t(null,!1),!0}function l(){const e=this.parentElement,t=e.id,n=Q.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&Q.splice(n,1):Q.push(t),V=!1,s()}function s(e,t=!0){if(t&&saveData(k,k.checked,!1),k.checked){const e=V?"all":Q.join(",");saveData(z,e),saveData(L,L.dataset.value)}else saveData(z,null),saveData(L,null)}function o(){const e="true"===this.dataset.value;this.dataset.value=!e,V=e,Q=[],J.forEach((e=>{e.open=!V,V&&Q.push(e.id)})),k.checked&&s(null,!1)}function r(){const e=this.dataset.partyId,t=W.indexOf(e);this.open&&-1===t?W.push(e):this.open||-1===t||W.splice(t,1)}function d(e){0!==G.children.length&&(H.hidden=!e,H.querySelector("#initialEmpty").hidden=e,H.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(S,S.checked,!1),u(S.checked)}function i(e,t=!0){t&&saveData(A,A.checked,!1),u(A.checked,!0)}function u(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=G.getElementsByClassName(n);for(const t of a)t.hidden=e}function m(e,t=!0){t&&saveData(T,T.checked,!1);const n=G.getElementsByClassName("dungeon-rank");for(const e of n)e.hidden=T.checked}function g(e,t=!0){t&&saveData(q,q.checked,!1);const n=q.checked,a=G.getElementsByClassName("party-player-role-icon"),l=G.getElementsByClassName("party-player-class-icon"),s=G.getElementsByClassName("party-player-role-text");for(const e of a)e.hidden=n;for(const e of l)e.hidden=!n;for(const e of s)e.hidden=!n}function y(e,t=!0){t&&saveData(F,F.checked,!1);const n=G.getElementsByClassName("dungeon-name");for(const e of n)e.textContent=F.checked?e.dataset.dungeonShortName:e.dataset.dungeonName}function h(){O.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function E(){e(),f(),J.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),P.forEach((e=>e.addEventListener("toggle",r)))}function f(){a(null,!1)||(n(null,!1),t(null,!1)),Q=V?J.map((e=>e.id)):Q.filter((e=>J.some((t=>t.id===e)))),J.forEach((e=>e.open=-1===Q.indexOf(e.id))),s(null,!1),c(null,!1),i(null,!1),m(null,!1),g(null,!1),y(null,!1),P.forEach((e=>e.open=-1!==W.indexOf(e.dataset.partyId))),W=W.filter((e=>P.some((t=>t.dataset.partyId===e))))}const p=document.getElementById("searchDungeonName"),v=document.getElementById("searchDungeonLevel"),C=document.getElementById("searchDungeonItemLevel"),B=document.getElementById("selectDungeonSort"),I=document.getElementById("selectDungeonRank"),L=document.getElementById("toggleDetails"),x=document.getElementById("clearNavigation"),N=document.getElementById("clearEmptyButton"),k=document.getElementById("saveCollapsed"),D=document.getElementById("mergeSupportMatching"),S=document.getElementById("hideLevel"),A=document.getElementById("hideItemLevel"),T=document.getElementById("hideRank"),q=document.getElementById("replaceRoleIcons"),F=document.getElementById("showShortNames"),R=document.getElementById("content"),w=document.getElementById("supportDungeon"),O=[p,v,C],b=[k,D,S,A,T,q,F],j=[B,I],M=2,U=0,z="dungeonDetailsCollapsed";let G,H,J,K,P;e();let Q=[],V=!1,W=[];B.addEventListener("change",n),p.addEventListener("input",t),v.addEventListener("input",t),C.addEventListener("input",t),I.addEventListener("change",t),J.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),P.forEach((e=>e.addEventListener("toggle",r))),k.addEventListener("change",s),D.addEventListener("change",a),S.addEventListener("change",c),A.addEventListener("change",i),T.addEventListener("change",m),q.addEventListener("change",g),F.addEventListener("change",y),R.addEventListener("contentUpdated",E),L.addEventListener("click",o),N.addEventListener("click",h),x.addEventListener("click",(function(){B.selectedIndex=M,I.selectedIndex=U,h()})),O.forEach((e=>e.value=loadData(e)??e.value)),b.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),j.forEach((e=>e.selectedIndex=loadData(e)??e.selectedIndex)),L.dataset.value=loadData(L)??L.dataset.value;const X=loadData(z);"all"===X?V=!0:Q=X?.split(",")??[],f()})();