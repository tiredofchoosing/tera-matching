(function(){function e(){j=document.getElementById("dungeonList"),M=document.getElementById("empty"),P=Array.from(j.getElementsByClassName("dungeon-details")),z=Array.from(j.getElementsByClassName("party-details")),U=null}function t(e,t=!0){t&&T.forEach((e=>saveData(e,e.value))),t&&saveData(C,C.selectedIndex);const n=h.value.customSplitFilter(","),l=v.value.customSplitFilter(","),a=f.value.customSplitFilter(","),s=C.value;let r=!1;P.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),o=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),d=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),c=e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank,i=n.customSomeFilter((e=>t.includes(e)))&&l.customSomeFilter((e=>checkLevel(o,e)))&&a.customSomeFilter((e=>checkLevel(d,e)))&&("default"===s||s==c);e.style.display=i?"":"none",r||=i})),d(!r)}function n(e,t=!0){function n(e,t,n){const l=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),a=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),r=parseInt(t.getElementsByClassName("dungeon-ilvl")[0].textContent),o=e.getElementsByClassName("dungeon-name")[0].textContent,d=t.getElementsByClassName("dungeon-name")[0].textContent,c=e.getElementsByClassName("party-player-detailed-content").length,i=t.getElementsByClassName("party-player-detailed-content").length,u=parseInt(e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank),m=parseInt(t.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank);switch(n){case"minLevelDesc":return a-l;case"minLevelAsc":return l-a;case"minItemLevelDesc":return r-s;case"minItemLevelAsc":return s-r;case"nameDesc":return d.localeCompare(o);case"nameAsc":return o.localeCompare(d);case"playersDesc":return i-c;case"playersAsc":return c-i;case"rankDesc":return m-u;case"rankAsc":return u-m}}t&&saveData(p,p.selectedIndex);const l=p.value,a=p.options[R].value;l!==a&&P.sort(((e,t)=>n(e,t,a))),P.sort(((e,t)=>n(e,t,l))),P.forEach((e=>j.appendChild(e)))}function l(e,l=!0){if(l&&saveData(D,D.checked,!1),null!=U){let e=P;P=U,U=e,U.forEach((e=>j.removeChild(e))),P.forEach((e=>j.appendChild(e)))}else{if(!D.checked)return!1;{let e=P.find((e=>e.querySelector(".dungeon-lvl").innerText==b.lowestDungeonLevel));if(null==e)return!1;let t=Array.from(e.getElementsByClassName("party-details")),n=t.filter((e=>e.querySelector(".party-player-detailed-content.level65")));if(0===n.length)return!1;let l=[];n.forEach((e=>{let t=Array.from(e.getElementsByClassName("party-summary"));t.forEach((e=>e.innerText.split("|").forEach((e=>{let t=e.trim().split(" ")[0];l.push(t)}))))}));let s=P.filter((e=>e.querySelector(".dungeon-lvl").innerText<b.minLevel&&null!=e.querySelector(".party-player-detailed-content.level65")));s.forEach((function(e){j.removeChild(e);let t=e.cloneNode(!0),s=Array.from(t.getElementsByClassName("party-details"));if(n.length===s.length)return;let r=Array.from(t.getElementsByClassName("dungeon-role"));l.forEach((e=>{r.forEach((t=>{if(t.innerText.includes(e)){let n=parseInt(t.innerText)-1;t.innerText=n+e}}))})),s.filter((e=>null!=e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>t.removeChild(e))),t.addEventListener("toggle",a),j.appendChild(t)}));let r=e.cloneNode(!0);r.setAttribute("id","9999"),r.querySelector(".dungeon-lvl").innerText=b.minLevel,r.querySelector(".dungeon-ilvl").innerText=b.minItemLevel,r.querySelector(".dungeon-name").innerText=b.name;let o=Array.from(r.getElementsByClassName("party-details"));if(n.length!==o.length){let e=Array.from(r.getElementsByClassName("dungeon-role"));e.forEach((e=>{let t=parseInt(e.innerText).toString().length;e.innerText=0+e.innerText.slice(t)})),l.forEach((t=>{e.forEach((e=>{if(e.innerText.includes(t)){let n=parseInt(e.innerText)+1;e.innerText=n+t}}))})),o.filter((e=>null==e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>{r.removeChild(e)}))}r.addEventListener("toggle",a),j.appendChild(r),U=P,P=Array.from(j.getElementsByClassName("dungeon-details"))}}return l&&s(null,!1),n(null,!1),t(null,!1),!0}function a(){const e=this.parentElement,t=e.id,n=G.indexOf(t),l=!e.open;l||-1!==n?l&&-1!==n&&G.splice(n,1):G.push(t),H=!1,s()}function s(e,t=!0){if(t&&saveData(x,x.checked,!1),x.checked){const e=H?"all":G.join(",");saveData(w,e),saveData(B,B.dataset.value)}else saveData(w,null),saveData(B,null)}function r(){const e="true"===this.dataset.value;this.dataset.value=!e,H=e,G=[],P.forEach((e=>{e.open=!H,H&&G.push(e.id)})),x.checked&&s(null,!1)}function o(){const e=this.dataset.partyId,t=J.indexOf(e);this.open&&-1===t?J.push(e):this.open||-1===t||J.splice(t,1)}function d(e){0!==j.children.length&&(M.hidden=!e,M.querySelector("#initialEmpty").hidden=e,M.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(k,k.checked,!1),u(k.checked)}function i(e,t=!0){t&&saveData(N,N.checked,!1),u(N.checked,!0)}function u(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",l=j.getElementsByClassName(n);for(const t of l)t.hidden=e}function m(e,t=!0){t&&saveData(S,S.checked,!1);const n=j.getElementsByClassName("dungeon-rank");for(const e of n)e.hidden=S.checked}function g(){T.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function y(){e(),E(),P.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),z.forEach((e=>e.addEventListener("toggle",o)))}function E(){l(null,!1)||(n(null,!1),t(null,!1)),G=H?P.map((e=>e.id)):G.filter((e=>P.some((t=>t.id===e)))),P.forEach((e=>e.open=-1===G.indexOf(e.id))),s(null,!1),c(null,!1),i(null,!1),m(null,!1),z.forEach((e=>e.open=-1!==J.indexOf(e.dataset.partyId))),J=J.filter((e=>z.some((t=>t.dataset.partyId===e))))}const h=document.getElementById("searchDungeonName"),v=document.getElementById("searchDungeonLevel"),f=document.getElementById("searchDungeonItemLevel"),p=document.getElementById("selectDungeonSort"),C=document.getElementById("selectDungeonRank"),B=document.getElementById("toggleDetails"),I=document.getElementById("clearNavigation"),L=document.getElementById("clearEmptyButton"),x=document.getElementById("saveCollapsed"),D=document.getElementById("mergeSupportMatching"),k=document.getElementById("hideLevel"),N=document.getElementById("hideItemLevel"),S=document.getElementById("hideRank"),A=document.getElementById("content"),T=[h,v,f],q=[x,D,k,N,S],F=[p,C],R=2,O=0,w="dungeonDetailsCollapsed",b=supportDungeonProps;let j,M,P,U,z;e();let G=[],H=!1,J=[];p.addEventListener("change",n),h.addEventListener("input",t),v.addEventListener("input",t),f.addEventListener("input",t),C.addEventListener("change",t),P.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),z.forEach((e=>e.addEventListener("toggle",o))),x.addEventListener("change",s),D.addEventListener("change",l),k.addEventListener("change",c),N.addEventListener("change",i),S.addEventListener("change",m),A.addEventListener("contentUpdated",y),B.addEventListener("click",r),L.addEventListener("click",g),I.addEventListener("click",(function(){p.selectedIndex=R,C.selectedIndex=O,g()})),T.forEach((e=>e.value=loadData(e)??e.value)),q.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),F.forEach((e=>e.selectedIndex=loadData(e)??e.selectedIndex)),B.dataset.value=loadData(B)??B.dataset.value;const K=loadData(w);"all"===K?H=!0:G=K?.split(",")??[],E()})();