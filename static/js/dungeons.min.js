(function(){function e(){U=document.getElementById("dungeonList"),z=document.getElementById("empty"),G=Array.from(U.getElementsByClassName("dungeon-details")),J=Array.from(U.getElementsByClassName("party-details")),H=null}function t(e,t=!0){t&&R.forEach((e=>saveData(e,e.value))),t&&saveData(B,B.selectedIndex);const n=f.value.customSplitFilter(","),a=p.value.customSplitFilter(","),l=v.value.customSplitFilter(","),s=B.value;let r=!1;G.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),o=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),d=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),c=e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank,i=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(o,e)))&&l.customSomeFilter((e=>checkLevel(d,e)))&&("default"===s||s==c);e.style.display=i?"":"none",r||=i})),d(!r)}function n(e,t=!0){function n(e,t,n){const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),r=parseInt(t.getElementsByClassName("dungeon-ilvl")[0].textContent),o=e.getElementsByClassName("dungeon-name")[0].textContent,d=t.getElementsByClassName("dungeon-name")[0].textContent,c=e.getElementsByClassName("party-player-detailed-content").length,i=t.getElementsByClassName("party-player-detailed-content").length,u=parseInt(e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank),m=parseInt(t.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank);switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"minItemLevelDesc":return r-s;case"minItemLevelAsc":return s-r;case"nameDesc":return d.localeCompare(o);case"nameAsc":return o.localeCompare(d);case"playersDesc":return i-c;case"playersAsc":return c-i;case"rankDesc":return m-u;case"rankAsc":return u-m}}t&&saveData(C,C.selectedIndex);const a=C.value,l=C.options[b].value;a!==l&&G.sort(((e,t)=>n(e,t,l))),G.sort(((e,t)=>n(e,t,a))),G.forEach((e=>U.appendChild(e)))}function a(e,a=!0){if(a&&saveData(D,D.checked,!1),null!=H){let e=G;G=H,H=e,H.forEach((e=>U.removeChild(e))),G.forEach((e=>U.appendChild(e)))}else{if(!D.checked)return!1;{let e=G.find((e=>e.querySelector(".dungeon-lvl").innerText==F.dataset.lowestDungeonLevel));if(null==e)return!1;let t=Array.from(e.getElementsByClassName("party-details")),n=t.filter((e=>e.querySelector(".party-player-detailed-content.level65")));if(0===n.length)return!1;let a=[];n.forEach((e=>{let t=Array.from(e.getElementsByClassName("party-summary"));t.forEach((e=>e.innerText.split("|").forEach((e=>{let t=e.trim().split(" ")[0];a.push(t)}))))}));let s=G.filter((e=>e.querySelector(".dungeon-lvl").innerText<parseInt(F.dataset.minLevel)&&null!=e.querySelector(".party-player-detailed-content.level65")));s.forEach((function(e){U.removeChild(e);let t=e.cloneNode(!0),s=Array.from(t.getElementsByClassName("party-details"));if(n.length===s.length)return;let r=Array.from(t.getElementsByClassName("dungeon-role"));a.forEach((e=>{r.forEach((t=>{if(t.innerText.includes(e)){let n=parseInt(t.innerText)-1;t.innerText=n+e}}))})),s.filter((e=>null!=e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>t.removeChild(e))),t.addEventListener("toggle",l),U.appendChild(t)}));let r=e.cloneNode(!0);r.setAttribute("id",F.dataset.id),r.querySelector(".dungeon-lvl").innerText=F.dataset.minLevel,r.querySelector(".dungeon-ilvl").innerText=F.dataset.minItemLevel,r.querySelector(".dungeon-name").innerText=F.dataset.name;let o=Array.from(r.getElementsByClassName("party-details"));if(n.length!==o.length){let e=Array.from(r.getElementsByClassName("dungeon-role"));e.forEach((e=>{let t=parseInt(e.innerText).toString().length;e.innerText=0+e.innerText.slice(t)})),a.forEach((t=>{e.forEach((e=>{if(e.innerText.includes(t)){let n=parseInt(e.innerText)+1;e.innerText=n+t}}))})),o.filter((e=>null==e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>{r.removeChild(e)}))}r.addEventListener("toggle",l),U.appendChild(r),H=G,G=Array.from(U.getElementsByClassName("dungeon-details"))}}return a&&s(null,!1),n(null,!1),t(null,!1),!0}function l(){const e=this.parentElement,t=e.id,n=K.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&K.splice(n,1):K.push(t),P=!1,s()}function s(e,t=!0){if(t&&saveData(k,k.checked,!1),k.checked){const e=P?"all":K.join(",");saveData(M,e),saveData(I,I.dataset.value)}else saveData(M,null),saveData(I,null)}function r(){const e="true"===this.dataset.value;this.dataset.value=!e,P=e,K=[],G.forEach((e=>{e.open=!P,P&&K.push(e.id)})),k.checked&&s(null,!1)}function o(){const e=this.dataset.partyId,t=Q.indexOf(e);this.open&&-1===t?Q.push(e):this.open||-1===t||Q.splice(t,1)}function d(e){0!==U.children.length&&(z.hidden=!e,z.querySelector("#initialEmpty").hidden=e,z.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(N,N.checked,!1),u(N.checked)}function i(e,t=!0){t&&saveData(S,S.checked,!1),u(S.checked,!0)}function u(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=U.getElementsByClassName(n);for(const t of a)t.hidden=e}function m(e,t=!0){t&&saveData(A,A.checked,!1);const n=U.getElementsByClassName("dungeon-rank");for(const e of n)e.hidden=A.checked}function g(e,t=!0){t&&saveData(T,T.checked,!1);const n=T.checked,a=U.getElementsByClassName("party-player-role-icon"),l=U.getElementsByClassName("party-player-class-icon"),s=U.getElementsByClassName("party-player-role-text");for(const e of a)e.hidden=n;for(const e of l)e.hidden=!n;for(const e of s)e.hidden=!n}function y(){R.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function E(){e(),h(),G.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),J.forEach((e=>e.addEventListener("toggle",o)))}function h(){a(null,!1)||(n(null,!1),t(null,!1)),K=P?G.map((e=>e.id)):K.filter((e=>G.some((t=>t.id===e)))),G.forEach((e=>e.open=-1===K.indexOf(e.id))),s(null,!1),c(null,!1),i(null,!1),m(null,!1),g(null,!1),J.forEach((e=>e.open=-1!==Q.indexOf(e.dataset.partyId))),Q=Q.filter((e=>J.some((t=>t.dataset.partyId===e))))}const f=document.getElementById("searchDungeonName"),p=document.getElementById("searchDungeonLevel"),v=document.getElementById("searchDungeonItemLevel"),C=document.getElementById("selectDungeonSort"),B=document.getElementById("selectDungeonRank"),I=document.getElementById("toggleDetails"),L=document.getElementById("clearNavigation"),x=document.getElementById("clearEmptyButton"),k=document.getElementById("saveCollapsed"),D=document.getElementById("mergeSupportMatching"),N=document.getElementById("hideLevel"),S=document.getElementById("hideItemLevel"),A=document.getElementById("hideRank"),T=document.getElementById("replaceRoleIcons"),q=document.getElementById("content"),F=document.getElementById("supportDungeon"),R=[f,p,v],O=[k,D,N,S,A,T],w=[C,B],b=2,j=0,M="dungeonDetailsCollapsed";let U,z,G,H,J;e();let K=[],P=!1,Q=[];C.addEventListener("change",n),f.addEventListener("input",t),p.addEventListener("input",t),v.addEventListener("input",t),B.addEventListener("change",t),G.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),J.forEach((e=>e.addEventListener("toggle",o))),k.addEventListener("change",s),D.addEventListener("change",a),N.addEventListener("change",c),S.addEventListener("change",i),A.addEventListener("change",m),T.addEventListener("change",g),q.addEventListener("contentUpdated",E),I.addEventListener("click",r),x.addEventListener("click",y),L.addEventListener("click",(function(){C.selectedIndex=b,B.selectedIndex=j,y()})),R.forEach((e=>e.value=loadData(e)??e.value)),O.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),w.forEach((e=>e.selectedIndex=loadData(e)??e.selectedIndex)),I.dataset.value=loadData(I)??I.dataset.value;const V=loadData(M);"all"===V?P=!0:K=V?.split(",")??[],h()})();