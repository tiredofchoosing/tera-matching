(function(){function e(){j=document.getElementById("dungeonList"),M=document.getElementById("empty"),U=Array.from(j.getElementsByClassName("dungeon-details")),G=Array.from(j.getElementsByClassName("party-details")),z=null}function t(e,t=!0){t&&q.forEach((e=>saveData(e,e.value))),t&&saveData(C,C.selectedIndex);const n=h.value.customSplitFilter(","),a=v.value.customSplitFilter(","),l=f.value.customSplitFilter(","),s=C.value;let r=!1;U.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),d=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),o=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),c=e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank,i=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(d,e)))&&l.customSomeFilter((e=>checkLevel(o,e)))&&("default"===s||s==c);e.style.display=i?"":"none",r||=i})),o(!r)}function n(e,t=!0){function n(e,t,n){const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=parseInt(e.getElementsByClassName("dungeon-ilvl")[0].textContent),r=parseInt(t.getElementsByClassName("dungeon-ilvl")[0].textContent),d=e.getElementsByClassName("dungeon-name")[0].textContent,o=t.getElementsByClassName("dungeon-name")[0].textContent,c=e.getElementsByClassName("party-player-detailed-content").length,i=t.getElementsByClassName("party-player-detailed-content").length,u=parseInt(e.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank),m=parseInt(t.getElementsByClassName("dungeon-rank")[0].dataset.dungeonRank);switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"minItemLevelDesc":return r-s;case"minItemLevelAsc":return s-r;case"nameDesc":return o.localeCompare(d);case"nameAsc":return d.localeCompare(o);case"playersDesc":return i-c;case"playersAsc":return c-i;case"rankDesc":return m-u;case"rankAsc":return u-m}}t&&saveData(p,p.selectedIndex);const a=p.value,l=p.options[O].value;a!==l&&U.sort(((e,t)=>n(e,t,l))),U.sort(((e,t)=>n(e,t,a))),U.forEach((e=>j.appendChild(e)))}function a(e,a=!0){if(a&&saveData(D,D.checked,!1),null!=z){let e=U;U=z,z=e,z.forEach((e=>j.removeChild(e))),U.forEach((e=>j.appendChild(e)))}else{if(!D.checked)return!1;{let e=U.find((e=>e.querySelector(".dungeon-lvl").innerText==T.dataset.lowestDungeonLevel));if(null==e)return!1;let t=Array.from(e.getElementsByClassName("party-details")),n=t.filter((e=>e.querySelector(".party-player-detailed-content.level65")));if(0===n.length)return!1;let a=[];n.forEach((e=>{let t=Array.from(e.getElementsByClassName("party-summary"));t.forEach((e=>e.innerText.split("|").forEach((e=>{let t=e.trim().split(" ")[0];a.push(t)}))))}));let s=U.filter((e=>e.querySelector(".dungeon-lvl").innerText<parseInt(T.dataset.minLevel)&&null!=e.querySelector(".party-player-detailed-content.level65")));s.forEach((function(e){j.removeChild(e);let t=e.cloneNode(!0),s=Array.from(t.getElementsByClassName("party-details"));if(n.length===s.length)return;let r=Array.from(t.getElementsByClassName("dungeon-role"));a.forEach((e=>{r.forEach((t=>{if(t.innerText.includes(e)){let n=parseInt(t.innerText)-1;t.innerText=n+e}}))})),s.filter((e=>null!=e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>t.removeChild(e))),t.addEventListener("toggle",l),j.appendChild(t)}));let r=e.cloneNode(!0);r.setAttribute("id",T.dataset.id),r.querySelector(".dungeon-lvl").innerText=T.dataset.minLevel,r.querySelector(".dungeon-ilvl").innerText=T.dataset.minItemLevel,r.querySelector(".dungeon-name").innerText=T.dataset.name;let d=Array.from(r.getElementsByClassName("party-details"));if(n.length!==d.length){let e=Array.from(r.getElementsByClassName("dungeon-role"));e.forEach((e=>{let t=parseInt(e.innerText).toString().length;e.innerText=0+e.innerText.slice(t)})),a.forEach((t=>{e.forEach((e=>{if(e.innerText.includes(t)){let n=parseInt(e.innerText)+1;e.innerText=n+t}}))})),d.filter((e=>null==e.querySelector(".party-player-detailed-content.level65"))).forEach((e=>{r.removeChild(e)}))}r.addEventListener("toggle",l),j.appendChild(r),z=U,U=Array.from(j.getElementsByClassName("dungeon-details"))}}return a&&s(null,!1),n(null,!1),t(null,!1),!0}function l(){const e=this.parentElement,t=e.id,n=H.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&H.splice(n,1):H.push(t),J=!1,s()}function s(e,t=!0){if(t&&saveData(x,x.checked,!1),x.checked){const e=J?"all":H.join(",");saveData(b,e),saveData(B,B.dataset.value)}else saveData(b,null),saveData(B,null)}function r(){const e="true"===this.dataset.value;this.dataset.value=!e,J=e,H=[],U.forEach((e=>{e.open=!J,J&&H.push(e.id)})),x.checked&&s(null,!1)}function d(){const e=this.dataset.partyId,t=K.indexOf(e);this.open&&-1===t?K.push(e):this.open||-1===t||K.splice(t,1)}function o(e){0!==j.children.length&&(M.hidden=!e,M.querySelector("#initialEmpty").hidden=e,M.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(k,k.checked,!1),u(k.checked)}function i(e,t=!0){t&&saveData(N,N.checked,!1),u(N.checked,!0)}function u(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=j.getElementsByClassName(n);for(const t of a)t.hidden=e}function m(e,t=!0){t&&saveData(S,S.checked,!1);const n=j.getElementsByClassName("dungeon-rank");for(const e of n)e.hidden=S.checked}function g(){q.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function y(){e(),E(),U.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),G.forEach((e=>e.addEventListener("toggle",d)))}function E(){a(null,!1)||(n(null,!1),t(null,!1)),H=J?U.map((e=>e.id)):H.filter((e=>U.some((t=>t.id===e)))),U.forEach((e=>e.open=-1===H.indexOf(e.id))),s(null,!1),c(null,!1),i(null,!1),m(null,!1),G.forEach((e=>e.open=-1!==K.indexOf(e.dataset.partyId))),K=K.filter((e=>G.some((t=>t.dataset.partyId===e))))}const h=document.getElementById("searchDungeonName"),v=document.getElementById("searchDungeonLevel"),f=document.getElementById("searchDungeonItemLevel"),p=document.getElementById("selectDungeonSort"),C=document.getElementById("selectDungeonRank"),B=document.getElementById("toggleDetails"),I=document.getElementById("clearNavigation"),L=document.getElementById("clearEmptyButton"),x=document.getElementById("saveCollapsed"),D=document.getElementById("mergeSupportMatching"),k=document.getElementById("hideLevel"),N=document.getElementById("hideItemLevel"),S=document.getElementById("hideRank"),A=document.getElementById("content"),T=document.getElementById("supportDungeon"),q=[h,v,f],F=[x,D,k,N,S],R=[p,C],O=2,w=0,b="dungeonDetailsCollapsed";let j,M,U,z,G;e();let H=[],J=!1,K=[];p.addEventListener("change",n),h.addEventListener("input",t),v.addEventListener("input",t),f.addEventListener("input",t),C.addEventListener("change",t),U.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",l))),G.forEach((e=>e.addEventListener("toggle",d))),x.addEventListener("change",s),D.addEventListener("change",a),k.addEventListener("change",c),N.addEventListener("change",i),S.addEventListener("change",m),A.addEventListener("contentUpdated",y),B.addEventListener("click",r),L.addEventListener("click",g),I.addEventListener("click",(function(){p.selectedIndex=O,C.selectedIndex=w,g()})),q.forEach((e=>e.value=loadData(e)??e.value)),F.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),R.forEach((e=>e.selectedIndex=loadData(e)??e.selectedIndex)),B.dataset.value=loadData(B)??B.dataset.value;const P=loadData(b);"all"===P?J=!0:H=P?.split(",")??[],E()})();