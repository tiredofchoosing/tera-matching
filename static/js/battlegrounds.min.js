(function(){function e(){O=document.getElementById("dungeonList"),q=document.getElementById("empty"),w=Array.from(O.getElementsByClassName("dungeon-details")),F=Array.from(O.getElementsByClassName("party-details"))}function t(e,t=!0){t&&D.forEach((e=>saveData(e,e.value)));const n=h.value.customSplitFilter(","),a=g.value.customSplitFilter(",");let l=!1;w.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),s=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),o=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(s,e)));e.style.display=o?"":"none",l||=o})),d(!l)}function n(e,t=!0){t&&saveData(p,p.selectedIndex);const n=p.value;w.sort(((e,t)=>{const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=e.getElementsByClassName("dungeon-name")[0].textContent,o=t.getElementsByClassName("dungeon-name")[0].textContent,d=e.getElementsByClassName("party-player-detailed-content").length,c=t.getElementsByClassName("party-player-detailed-content").length;switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"nameDesc":return o.localeCompare(s);case"nameAsc":return s.localeCompare(o);case"playersDesc":return c-d;case"playersAsc":return d-c}})),w.forEach((e=>O.appendChild(e)))}function a(){const e=this.parentElement,t=e.id,n=M.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&M.splice(n,1):M.push(t),X=!1,l()}function l(e,t=!0){if(t&&saveData(v,v.checked,!1),v.checked){const e=X?"all":M.join(",");saveData(N,e),saveData(E,E.dataset.value)}else saveData(N,null),saveData(E,null)}function s(){const e="true"===this.dataset.value;this.dataset.value=!e,X=e,M=[],w.forEach((e=>{e.open=!X,X&&M.push(e.id)})),v.checked&&l(null,!1)}function o(){const e=this.dataset.partyId,t=b.indexOf(e);this.open&&-1===t?b.push(e):this.open||-1===t||b.splice(t,1)}function d(e){0!==O.children.length&&(q.hidden=!e,q.querySelector("#initialEmpty").hidden=e,q.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(B,B.checked,!1),u(B.checked)}function u(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=O.getElementsByClassName(n);for(const t of a)t.hidden=e}function i(){D.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function r(){e(),m(),w.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),F.forEach((e=>e.addEventListener("toggle",o)))}function m(){n(null,!1),t(null,!1),O.style.fontSize=S[z],M=X?w.map((e=>e.id)):M.filter((e=>w.some((t=>t.id===e)))),w.forEach((e=>e.open=-1===M.indexOf(e.id))),l(null,!1),c(null,!1),F.forEach((e=>e.open=-1!==b.indexOf(e.dataset.partyId))),b=b.filter((e=>F.some((t=>t.dataset.partyId===e))))}const h=document.getElementById("searchBattlegroundName"),g=document.getElementById("searchBattlegroundLevel"),p=document.getElementById("selectBattlegroundSort"),E=document.getElementById("toggleDetails"),y=document.getElementById("clearNavigation"),f=document.getElementById("clearEmptyButton"),v=document.getElementById("saveCollapsed"),B=document.getElementById("hideLevel"),C=document.body,L=document.getElementById("content"),D=[h,g],I=[v,B],x=4,N="battlegroundDetailsCollapsed",S=["13px","14px","16px"],k=30,A="pinchDungeonList";let O,q,w,F;e();let M=[],X=!1,Y=0,z=S.indexOf(window.getComputedStyle(O).fontSize),b=[];p.addEventListener("change",n),h.addEventListener("input",t),g.addEventListener("input",t),w.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),F.forEach((e=>e.addEventListener("toggle",o))),v.addEventListener("change",l),B.addEventListener("change",c),L.addEventListener("contentUpdated",r),E.addEventListener("click",s),f.addEventListener("click",i),y.addEventListener("click",(function(){p.selectedIndex=x,i()})),C.addEventListener("touchstart",(function(e){2===e.touches.length&&(Y=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY))})),C.addEventListener("touchmove",(function(e){if(2===e.touches.length){const t=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY);if(t-Y>k)z=Math.min(z+1,S.length-1);else{if(!(Y-t>k))return;z=Math.max(z-1,0)}O.style.fontSize=S[z],Y=t,saveData(A,z,!1)}})),C.addEventListener("touchend",(function(e){e.touches.length<2&&(Y=0)})),D.forEach((e=>e.value=loadData(e)??e.value)),I.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),p.selectedIndex=loadData(p)??p.selectedIndex,E.dataset.value=loadData(E)??E.dataset.value;const j=loadData(N);"all"===j?X=!0:M=j?.split(",")??[],z=loadData(A,!1)??z,m()})();