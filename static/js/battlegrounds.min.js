(function(){function e(){S=document.getElementById("dungeonList"),A=document.getElementById("empty"),q=Array.from(S.getElementsByClassName("dungeon-details")),F=Array.from(S.getElementsByClassName("party-details"))}function t(e,t=!0){t&&D.forEach((e=>saveData(e,e.value)));const n=g.value.customSplitFilter(","),a=y.value.customSplitFilter(",");let l=!1;q.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),s=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),d=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(s,e)));e.style.display=d?"":"none",l||=d})),o(!l)}function n(e,t=!0){t&&saveData(h,h.selectedIndex);const n=h.value;q.sort(((e,t)=>{const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=e.getElementsByClassName("dungeon-name")[0].textContent,d=t.getElementsByClassName("dungeon-name")[0].textContent,o=e.getElementsByClassName("party-player-detailed-content").length,c=t.getElementsByClassName("party-player-detailed-content").length;switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"nameDesc":return d.localeCompare(s);case"nameAsc":return s.localeCompare(d);case"playersDesc":return c-o;case"playersAsc":return o-c}})),q.forEach((e=>S.appendChild(e)))}function a(){const e=this.parentElement,t=e.id,n=O.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&O.splice(n,1):O.push(t),w=!1,l()}function l(e,t=!0){if(t&&saveData(B,B.checked,!1),B.checked){const e=w?"all":O.join(",");saveData(k,e),saveData(p,p.dataset.value)}else saveData(k,null),saveData(p,null)}function s(){const e="true"===this.dataset.value;this.dataset.value=!e,w=e,O=[],q.forEach((e=>{e.open=!w,w&&O.push(e.id)})),B.checked&&l(null,!1)}function d(){const e=this.dataset.partyId,t=b.indexOf(e);this.open&&-1===t?b.push(e):this.open||-1===t||b.splice(t,1)}function o(e){0!==S.children.length&&(A.hidden=!e,A.querySelector("#initialEmpty").hidden=e,A.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(C,C.checked,!1),r(C.checked)}function r(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=S.getElementsByClassName(n);for(const t of a)t.hidden=e}function i(e,t=!0){t&&saveData(I,I.checked,!1);const n=I.checked,a=S.getElementsByClassName("party-player-role-icon"),l=S.getElementsByClassName("party-player-class-icon"),s=S.getElementsByClassName("party-player-role-text");for(const e of a)e.hidden=n;for(const e of l)e.hidden=!n;for(const e of s)e.hidden=!n}function u(){D.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function m(){e(),E(),q.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),F.forEach((e=>e.addEventListener("toggle",d)))}function E(){n(null,!1),t(null,!1),O=w?q.map((e=>e.id)):O.filter((e=>q.some((t=>t.id===e)))),q.forEach((e=>e.open=-1===O.indexOf(e.id))),l(null,!1),c(null,!1),i(null,!1),F.forEach((e=>e.open=-1!==b.indexOf(e.dataset.partyId))),b=b.filter((e=>F.some((t=>t.dataset.partyId===e))))}const g=document.getElementById("searchBattlegroundName"),y=document.getElementById("searchBattlegroundLevel"),h=document.getElementById("selectBattlegroundSort"),p=document.getElementById("toggleDetails"),f=document.getElementById("clearNavigation"),v=document.getElementById("clearEmptyButton"),B=document.getElementById("saveCollapsed"),C=document.getElementById("hideLevel"),I=document.getElementById("replaceRoleIcons"),L=document.getElementById("content"),D=[g,y],N=[B,C,I],x=4,k="battlegroundDetailsCollapsed";let S,A,q,F;e();let O=[],w=!1,b=[];h.addEventListener("change",n),g.addEventListener("input",t),y.addEventListener("input",t),q.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),F.forEach((e=>e.addEventListener("toggle",d))),B.addEventListener("change",l),C.addEventListener("change",c),I.addEventListener("change",i),L.addEventListener("contentUpdated",m),p.addEventListener("click",s),v.addEventListener("click",u),f.addEventListener("click",(function(){h.selectedIndex=x,u()})),D.forEach((e=>e.value=loadData(e)??e.value)),N.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),h.selectedIndex=loadData(h)??h.selectedIndex,p.dataset.value=loadData(p)??p.dataset.value;const j=loadData(k);"all"===j?w=!0:O=j?.split(",")??[],E()})();