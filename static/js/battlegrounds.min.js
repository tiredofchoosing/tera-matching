(function(){let disableToggle=!0;function isToggleEnabled(){return!disableToggle}
window.addEventListener('load',()=>disableToggle=!1);const dungeonList=document.getElementById('dungeonList');const searchNameInput=document.getElementById('searchBattlegroundName');const searchMinLevelInput=document.getElementById('searchBattlegroundLevel');const sortSelect=document.getElementById('selectBattlegroundSort');const toggleDetailsButton=document.getElementById('toggleDetails');const clearNavigationButton=document.getElementById('clearNavigation');const autoupdateCheckbox=document.getElementById('autoupdateCheck');const saveCollapsedCheckbox=document.getElementById('saveCollapsed');const emptyContainer=document.getElementById('empty');const body=document.body;const searchInputs=[searchNameInput,searchMinLevelInput];const checkboxes=[autoupdateCheckbox,saveCollapsedCheckbox];const defaultSelectIndex=4;const saveCollapsedId='battlegroundDetailsCollapsed';const pinchFontSizes=['13px','14px','16px'];const pinchDelta=30;const pinchSaveId='pinchDungeonList';let dungeons=Array.from(dungeonList.getElementsByClassName('dungeon-details'));let pinchInitDist=0;let pinchCurrentIndex=pinchFontSizes.indexOf(window.getComputedStyle(dungeonList).fontSize);function filterDungeons(_,save=!0){save&&searchInputs.forEach(e=>saveData(e,e.value));let searchNameVal=searchNameInput.value.toLowerCase();let searchMinLevelVal=searchMinLevelInput.value;let any=!1;dungeons.forEach(d=>{let name=d.getElementsByClassName('dungeon-name')[0].textContent;let minLevel=parseInt(d.getElementsByClassName('dungeon-lvl')[0].textContent);let show=name.toLowerCase().includes(searchNameVal)&&checkLevel(minLevel,searchMinLevelVal);d.style.display=show?'':'none';any||=show});checkIfEmpty(any)}
function sortDungeons(_,save=!0){save&&saveData(sortSelect,sortSelect.selectedIndex);let sortVal=sortSelect.value;dungeons.sort((a,b)=>{let minLevelA=parseInt(a.getElementsByClassName('dungeon-lvl')[0].textContent);let minLevelB=parseInt(b.getElementsByClassName('dungeon-lvl')[0].textContent);let nameA=a.getElementsByClassName('dungeon-name')[0].textContent;let nameB=b.getElementsByClassName('dungeon-name')[0].textContent;let playersA=a.getElementsByClassName('party-player-detailed-content').length;let playersB=b.getElementsByClassName('party-player-detailed-content').length;switch(sortVal){case 'minLevelDesc':return minLevelB-minLevelA;case 'minLevelAsc':return minLevelA-minLevelB;case 'nameDesc':return nameB.localeCompare(nameA);case 'nameAsc':return nameA.localeCompare(nameB);case 'playersDesc':return playersB-playersA;case 'playersAsc':return playersA-playersB}});dungeons.forEach(d=>dungeonList.appendChild(d))}
function saveDetailsCollapsed(_,save=!0){save&&saveData(saveCollapsedCheckbox,saveCollapsedCheckbox.checked);if(saveCollapsedCheckbox.checked){if(dungeons.every(d=>!d.open)){saveData(saveCollapsedId,'all')}else if(dungeons.every(d=>d.open)){saveData(saveCollapsedId,null)}else{let ids=dungeons.filter(d=>!d.open).map(d=>d.getAttribute('id')).join(',')
saveData(saveCollapsedId,ids)}
saveData(toggleDetailsButton,toggleDetailsButton.value)}else{saveData(saveCollapsedId,null);saveData(toggleDetailsButton,null)}}
function dungeonDetailsToggleHandler(){if(isToggleEnabled())
saveDetailsCollapsed(null,!1);}
function checkIfEmpty(any){emptyContainer.hidden=any}
function updateCollapseIcon(){let value=toggleDetailsButton.value==='true';toggleDetailsButton.firstElementChild.src=`/static/img/icons/${value ? 'collapse' : 'expand'}.svg`}
sortSelect.addEventListener('change',sortDungeons);searchNameInput.addEventListener('input',filterDungeons);searchMinLevelInput.addEventListener('input',filterDungeons);dungeons.forEach(d=>d.addEventListener('toggle',dungeonDetailsToggleHandler));autoupdateCheckbox.addEventListener('change',setAutoupdate);saveCollapsedCheckbox.addEventListener('change',saveDetailsCollapsed);clearNavigationButton.addEventListener('click',function(){searchInputs.forEach(e=>e.value='');sortSelect.selectedIndex=defaultSelectIndex;sortDungeons(null,!0);filterDungeons(null,!0)});toggleDetailsButton.addEventListener('click',function(){let isOpen=this.value==='true';this.value=!isOpen;if(saveCollapsedCheckbox.checked)
saveData(this,this.value);disableToggle=!0;dungeons.forEach(d=>d.open=!isOpen);disableToggle=!1;saveDetailsCollapsed(null,!1);updateCollapseIcon()});body.addEventListener('touchstart',function(e){if(e.touches.length===2){pinchInitDist=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY)}});body.addEventListener('touchmove',function(e){if(e.touches.length===2){let distance=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY);if(distance-pinchInitDist>pinchDelta){pinchCurrentIndex=Math.min(pinchCurrentIndex+1,pinchFontSizes.length-1)}else if(pinchInitDist-distance>pinchDelta){pinchCurrentIndex=Math.max(pinchCurrentIndex-1,0)}else return;dungeonList.style.fontSize=pinchFontSizes[pinchCurrentIndex];pinchInitDist=distance;saveData(pinchSaveId,pinchCurrentIndex,!1)}});body.addEventListener('touchend',function(e){if(e.touches.length<2){pinchInitDist=0}});searchInputs.forEach(e=>e.value=loadData(e)??e.value);checkboxes.forEach(e=>{let checked=loadData(e);if(checked!=null)
e.checked=checked==='true'});sortSelect.selectedIndex=loadData(sortSelect)??sortSelect.selectedIndex;toggleDetailsButton.value=loadData(toggleDetailsButton)??toggleDetailsButton.value;updateCollapseIcon();sortDungeons(null,!1);filterDungeons(null,!1);setAutoupdate(null,!1,autoupdateCheckbox);let saveCollapsedVal=loadData(saveCollapsedId);if(saveCollapsedVal==='all'){dungeons.forEach(d=>d.open=!1)}else if(saveCollapsedVal!=null){saveCollapsedVal.split(',').forEach(id=>{let d=document.getElementById(id);if(d!=null)
d.open=!1});saveDetailsCollapsed(null,!1)}
let savedPinchIndex=loadData(pinchSaveId,!1);if(savedPinchIndex!=null){pinchCurrentIndex=savedPinchIndex;dungeonList.style.fontSize=pinchFontSizes[pinchCurrentIndex]}})()