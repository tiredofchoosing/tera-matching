(function(){function e(){N=document.getElementById("dungeonList"),k=document.getElementById("empty"),S=Array.from(N.getElementsByClassName("dungeon-details")),A=Array.from(N.getElementsByClassName("party-details"))}function t(e,t=!0){t&&I.forEach((e=>saveData(e,e.value)));const n=E.value.customSplitFilter(","),a=g.value.customSplitFilter(",");let l=!1;S.forEach((e=>{const t=e.getElementsByClassName("dungeon-name")[0].textContent.toLowerCase(),s=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),d=n.customSomeFilter((e=>t.includes(e)))&&a.customSomeFilter((e=>checkLevel(s,e)));e.style.display=d?"":"none",l||=d})),o(!l)}function n(e,t=!0){t&&saveData(y,y.selectedIndex);const n=y.value;S.sort(((e,t)=>{const a=parseInt(e.getElementsByClassName("dungeon-lvl")[0].textContent),l=parseInt(t.getElementsByClassName("dungeon-lvl")[0].textContent),s=e.getElementsByClassName("dungeon-name")[0].textContent,d=t.getElementsByClassName("dungeon-name")[0].textContent,o=e.getElementsByClassName("party-player-detailed-content").length,c=t.getElementsByClassName("party-player-detailed-content").length;switch(n){case"minLevelDesc":return l-a;case"minLevelAsc":return a-l;case"nameDesc":return d.localeCompare(s);case"nameAsc":return s.localeCompare(d);case"playersDesc":return c-o;case"playersAsc":return o-c}})),S.forEach((e=>N.appendChild(e)))}function a(){const e=this.parentElement,t=e.id,n=q.indexOf(t),a=!e.open;a||-1!==n?a&&-1!==n&&q.splice(n,1):q.push(t),F=!1,l()}function l(e,t=!0){if(t&&saveData(f,f.checked,!1),f.checked){const e=F?"all":q.join(",");saveData(x,e),saveData(h,h.dataset.value)}else saveData(x,null),saveData(h,null)}function s(){const e="true"===this.dataset.value;this.dataset.value=!e,F=e,q=[],S.forEach((e=>{e.open=!F,F&&q.push(e.id)})),f.checked&&l(null,!1)}function d(){const e=this.dataset.partyId,t=O.indexOf(e);this.open&&-1===t?O.push(e):this.open||-1===t||O.splice(t,1)}function o(e){0!==N.children.length&&(k.hidden=!e,k.querySelector("#initialEmpty").hidden=e,k.querySelector("#filteredEmpty").hidden=!e)}function c(e,t=!0){t&&saveData(B,B.checked,!1),r(B.checked)}function r(e,t=!1){const n=t?"dungeon-ilvl":"dungeon-lvl",a=N.getElementsByClassName(n);for(const t of a)t.hidden=e}function i(){I.forEach((e=>e.value="")),n(null,!0),t(null,!0)}function u(){e(),m(),S.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),A.forEach((e=>e.addEventListener("toggle",d)))}function m(){n(null,!1),t(null,!1),q=F?S.map((e=>e.id)):q.filter((e=>S.some((t=>t.id===e)))),S.forEach((e=>e.open=-1===q.indexOf(e.id))),l(null,!1),c(null,!1),A.forEach((e=>e.open=-1!==O.indexOf(e.dataset.partyId))),O=O.filter((e=>A.some((t=>t.dataset.partyId===e))))}const E=document.getElementById("searchBattlegroundName"),g=document.getElementById("searchBattlegroundLevel"),y=document.getElementById("selectBattlegroundSort"),h=document.getElementById("toggleDetails"),v=document.getElementById("clearNavigation"),p=document.getElementById("clearEmptyButton"),f=document.getElementById("saveCollapsed"),B=document.getElementById("hideLevel"),C=document.getElementById("content"),I=[E,g],L=[f,B],D=4,x="battlegroundDetailsCollapsed";let N,k,S,A;e();let q=[],F=!1,O=[];y.addEventListener("change",n),E.addEventListener("input",t),g.addEventListener("input",t),S.forEach((e=>e.querySelector(".dungeon-summary").addEventListener("click",a))),A.forEach((e=>e.addEventListener("toggle",d))),f.addEventListener("change",l),B.addEventListener("change",c),C.addEventListener("contentUpdated",u),h.addEventListener("click",s),p.addEventListener("click",i),v.addEventListener("click",(function(){y.selectedIndex=D,i()})),I.forEach((e=>e.value=loadData(e)??e.value)),L.forEach((e=>{const t=loadData(e,!1);null!=t&&(e.checked="true"===t)})),y.selectedIndex=loadData(y)??y.selectedIndex,h.dataset.value=loadData(h)??h.dataset.value;const w=loadData(x);"all"===w?F=!0:q=w?.split(",")??[],m()})();